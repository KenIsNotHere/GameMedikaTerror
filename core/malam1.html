<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malam 1 - Mari kita ungkap</title>
    <style>
        /* --- RESET & SYSTEM --- */
        * { padding: 0; margin: 0; box-sizing: border-box; user-select: none; }
        
        body {
            background-color: black;
            width: 100vw; height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- VIEWPORT RESPONSIVE (Rasio 16:9) --- */
        #viewport {
            position: relative;
            background-color: #111; /* Warna Abu-abu Gelap dasar */
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);

            /* --- ANIMASI BERNAFAS --- */
            /* Aktifkan animasi bernafas di sini */
            animation: breathingView 4s infinite ease-in-out, animasiLampuRedup 5s infinite alternate;
            transform-origin: center center; /* Penting untuk scaling */
        }

        /* Keyframes untuk Animasi Bernafas */
        @keyframes breathingView {
            0% {
                transform: translateY(0px) scale(1);
            }
            50% {
                /* Sedikit naik dan scale/zoom kecil untuk efek "menjauh" */
                transform: translateY(-0.5%) scale(1.005); 
            }
            100% {
                transform: translateY(0px) scale(1);
            }
        }

        @keyframes animasiLampuRedup {
            0%{
                filter: brightness(0.8);
            }
            100%{
                filter: brightness(1);
            }
        }

        /* Layar Lebar (Desktop) */
        @media (min-aspect-ratio: 16/9) {
            #viewport { height: 100vh; width: 177.78vh; }
            html { font-size: 2vh; } 
        }

        /* Layar Sempit (Mobile/Tablet) */
        @media (max-aspect-ratio: 16/9) {
            #viewport { width: 100vw; height: 56.25vw; }
            html { font-size: 2vw; }
        }

        /* --- GAME WORLD LAYERS --- */
        
        /* Interface Layer */
        #interface {
            width: 100%; height: 100%;
            position: absolute; top: 0; left: 0;
            pointer-events: none; /* Agar tembus ke trigger box */
        }

        /* --- SYSTEM PANORAMA (INTI PERBAIKAN) --- */
        #main {
            display: flex;              /* Susun ke samping */
            width: 300%;               /* WAJIB 300% (3 x Lebar Layar) */
            height: 100%;
            position: absolute;
            top: 0; left: 0;
            will-change: transform;
            filter: brightness(1.5);
        }

        .main-img {
            width: 33.3333%;           /* WAJIB 1/3 dari #main */
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* DEBUG COLORS: Jika gambar rusak, warna ini akan muncul */
        #mainImg1 { background-color: #550000; } /* Merah Tua (Kiri) */
        #mainImg2 { background-color: #005500; } /* Hijau Tua (Tengah) */
        #mainImg3 { background-color: #000055; } /* Biru Tua (Kanan) */

        /* --- TRIGGERS & UI --- */
        
        /* Trigger Area Kiri/Kanan */
        .viewSide {
            position: absolute;
            width: 15%; height: 100%;
            z-index: 50; /* Harus tinggi agar kena mouse */
            top: 0;
            cursor: w-resize;
        }
        #viewLeftBox { left: 0; }
        #viewRightBox { right: 0; }

        /* Layer UI Atas */
        #UI {
            position: absolute; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 60;
        }

        /* Tombol CCTV */
        #cctvBtn {
            pointer-events: auto;
            position: absolute;
            bottom: 5%; left: 50%;
            transform: translateX(-50%);
            width: 50%; padding: 0.5%;
            background-color: rgba(0, 128, 0, 0.2);
            backdrop-filter: blur(5px);
            color: rgba(255, 255, 255, 0.463); text-align: center;
            font-size: 1.2rem;
            cursor: pointer; border: 1px solid rgba(255,255,255,0.1);
            transition: 0.2s;
        }
        #cctvBtn:hover { background-color: rgba(0, 128, 0, 0.5); }

        /* CCTV Animation */
        #cctvContainer {
            position: absolute; width: 100%; height: 100%;
            perspective: 1000px;
            display: flex; justify-content: center;
            pointer-events: none; overflow: hidden;
        }

        #cctv {
            width: 65%; position: absolute; bottom: 0;
            transform-origin: bottom center;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .hideCctv {
            transform: rotateX(110deg) translateY(20%);
            filter: blur(20px) brightness(0); opacity: 0;
        }
        .showCctv {
            transform: rotateX(0deg) translateY(-10%);
            filter: blur(0px) brightness(0.7); opacity: 1;
        }

        /* Start Screen */
        #startBtn {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.082);
            backdrop-filter: blur(5px);
            z-index: 99;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 2.5rem;
            cursor: pointer; text-transform: uppercase; letter-spacing: 2px;
        }

        /* --- ENTITIES LAYER --- */
        #entities {
            position: absolute;
            top: 0;
            
            /* Ukurannya harus 1/3 dari #main agar proporsional dengan 1 layar */
            width: 33.3333%; 
            height: 100%;
            
            /* PENTING: Z-Index agar di atas background tapi di bawah Static/UI */
            z-index: 5; 
            
            /* Flexbox untuk mengatur posisi hantu di dalam ruangan (tengah/bawah) */
            display: flex;
            justify-content: center; /* Tengah Horizontal */
            align-items: flex-end;   /* Berdiri di Lantai (Bawah) */
            pointer-events: none;    /* Agar klik tembus (kecuali mau di-klik) */
            
            /* POSISI RUANGAN (Ganti nilai left ini untuk memindah hantu) */
            /* left: 0%;       -> Ada di Ruang Kiri */
            /* left: 33.333%;  -> Ada di Ruang Tengah */
            /* left: 66.666%;  -> Ada di Ruang Kanan */
            left: 20%; 
        }

        #entityIMG {
            /* Ukuran hantu relatif terhadap layar */
            width: auto;  
            height: 60%;
            margin-bottom: 10%; /* Jarak dari bawah layar */
            
            /* Agar hantu bisa di klik (misal senter) */
            pointer-events: auto; 
            
            /* Animasi breathing sedikit biar seram */
            animation: breathing 3s infinite ease-in-out;
        }

        @keyframes breathing {
            0%, 100% { transform: scale(1); filter: brightness(0.8); }
            50% { transform: scale(1.02); filter: brightness(1); }
        }
        
    </style>
</head>
<body>

    <audio id="bgAudio" loop>
        <source src="./assets/audio/MainBgmHorror.mp3" type="audio/mpeg">
    </audio>

    <audio id="btnSfx">
        <source src="./assets/audio/mechanicalswish.mp3" type="audio/mpeg">
    </audio>

    <audio id="cctvStatic" loop>
        <source src="./assets/audio/ConstantStaticTv.mp3" type="audio/mpeg">
    </audio>

    <div id="viewport">
        <div id="main">
            <img src="./assets/image/M1/ss.png" id="mainImg1" class="main-img">
            <img src="./assets/image/M1/sd.png" id="mainImg2" class="main-img">
            <img src="./assets/image/M1/st.png" id="mainImg3" class="main-img">

            <div id="entities">
                <img src="./assets/image/animatronic.png" id="entityIMG" 
                     style="border: 2px dashed red; min-height: 200px;" 
                     alt="Entity">
            </div>
        </div>

        <div id="viewLeftBox" class="viewSide"></div>
        <div id="viewRightBox" class="viewSide"></div>

        <div id="UI">
            <div id="cctvContainer">
                <img src="./assets/image/komp.png" class="hideCctv" id="cctv">
            </div>
            <div id="cctvBtn">▲</div>
        </div>

        <div id="startBtn">Ketuk Untuk Memulai</div>
    </div>

    <script>
        const startBtn = document.getElementById('startBtn');
        const cctvBtn = document.getElementById('cctvBtn');
        const cctv = document.getElementById('cctv');
        const mainContainer = document.getElementById('main');
        const leftZone = document.getElementById('viewLeftBox');
        const rightZone = document.getElementById('viewRightBox');

        // --- AUDIO ELEMENTS ---
    const bgAudio = document.getElementById('bgAudio');
    const btnSfx = document.getElementById('btnSfx');
    const cctvStatic = document.getElementById('cctvStatic');

    // Set Volume Awal (Opsional: Biar gak kaget)
    bgAudio.volume = 0.7;    // 70% Volume
    btnSfx.volume = 1.0;     // 100% Volume
    cctvStatic.volume = 0.5; // 50% Volume 
        let isCctvActive = false;
        let currentPan = 50;
        let panSpeed = 0.8;
        let moveDirection = 0;

        function gameLoop() {
            if (moveDirection !== 0 && !isCctvActive) {
                currentPan += moveDirection * panSpeed;
                if (currentPan < 0) currentPan = 0;
                if (currentPan > 100) currentPan = 100;
            }
            const percentage = (currentPan / 100) * 66.666; 
            mainContainer.style.transform = `translateX(-${percentage}%)`;
            requestAnimationFrame(gameLoop);
        }

        leftZone.addEventListener('mouseenter', () => { moveDirection = -1; });
        leftZone.addEventListener('mouseleave', () => { if(moveDirection === -1) moveDirection = 0; });
        rightZone.addEventListener('mouseenter', () => { moveDirection = 1; });
        rightZone.addEventListener('mouseleave', () => { if(moveDirection === 1) moveDirection = 0; });

        const cctvMode = () => {
            // 1. Mainkan suara tombol (Set waktu ke 0 biar bisa dipam cepat)
        btnSfx.currentTime = 0;
        btnSfx.play();

            if(!isCctvActive){
                cctv.classList.replace("hideCctv", "showCctv");
                cctvBtn.innerHTML = "▼"; 

                // Mainkan suara static monitor
            cctvStatic.play();
            } else {
                cctv.classList.replace("showCctv", "hideCctv");
                cctvBtn.innerHTML = "▲"; 

                cctvStatic.pause();
            cctvStatic.currentTime = 0; // Reset ke awal
            }
            isCctvActive = !isCctvActive;
        }

        startBtn.addEventListener('click', () => {
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            else if (document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
            startBtn.style.display = "none";

            bgAudio.play();
            gameLoop();
        });

        cctvBtn.addEventListener("click", cctvMode);
        mainContainer.style.transform = `translateX(-33.333%)`; 
    </script>
</body>
</html>